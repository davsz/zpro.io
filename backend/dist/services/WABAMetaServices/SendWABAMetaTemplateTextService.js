'use strict';
const _0xd15c8e = _0x1eee;
function _0x1eee(_0x523e63, _0x4dbdbd) {
    const _0x5cace4 = _0x297e();
    return _0x1eee = function (_0x7aab8c, _0x1fc52b) {
        _0x7aab8c = _0x7aab8c - (0x2148 + 0xec2 + 0x3 * -0xf6b);
        let _0x5a8407 = _0x5cace4[_0x7aab8c];
        return _0x5a8407;
    }, _0x1eee(_0x523e63, _0x4dbdbd);
}
(function (_0x55cb72, _0x3806a7) {
    const _0x10c57a = _0x1eee, _0xe8acf5 = _0x55cb72();
    while (!![]) {
        try {
            const _0x6969fe = parseInt(_0x10c57a(0x1ff)) / (-0x19e5 * -0x1 + 0x1 * -0x1cce + 0x1 * 0x2ea) * (parseInt(_0x10c57a(0x1d7)) / (-0x6b1 + 0x612 + 0x1 * 0xa1)) + parseInt(_0x10c57a(0x22b)) / (-0x3cb * -0x6 + 0xaad * 0x2 + -0x2c19) * (-parseInt(_0x10c57a(0x1f9)) / (0x151a + 0x5 * -0xdf + 0x1 * -0x10bb)) + -parseInt(_0x10c57a(0x220)) / (-0x1e55 + -0x799 * -0x5 + 0x73 * -0x11) + -parseInt(_0x10c57a(0x215)) / (-0x2 * 0x189 + -0x1630 + 0x1948) * (parseInt(_0x10c57a(0x20f)) / (-0xe59 * 0x1 + 0xa12 * -0x1 + -0x2 * -0xc39)) + -parseInt(_0x10c57a(0x211)) / (-0x337 * -0xc + 0x12ac + 0x1c9c * -0x2) * (-parseInt(_0x10c57a(0x223)) / (0x9 * 0xb2 + 0x23ee + -0x2a27)) + -parseInt(_0x10c57a(0x1fa)) / (-0x1 * -0x161 + -0x2 * 0x113c + 0x303 * 0xb) + parseInt(_0x10c57a(0x231)) / (-0x20b4 + -0x1640 * -0x1 + 0xa7f) * (parseInt(_0x10c57a(0x22e)) / (-0x1ca1 + 0x17a8 + -0x505 * -0x1));
            if (_0x6969fe === _0x3806a7)
                break;
            else
                _0xe8acf5['push'](_0xe8acf5['shift']());
        } catch (_0x26dea1) {
            _0xe8acf5['push'](_0xe8acf5['shift']());
        }
    }
}(_0x297e, -0x31df8 + -0x1 * 0x4a321 + 0x74 * 0x176d));
var __awaiter = this && this[_0xd15c8e(0x1ca)] || function (_0x211b4d, _0x3e94ad, _0x461549, _0x285858) {
        const _0xb81108 = _0xd15c8e, _0x4fbe2d = {
                'YmVts': function (_0x5c0a99, _0x4a6308) {
                    return _0x5c0a99(_0x4a6308);
                },
                'hcJBS': function (_0x467f30, _0x303e14) {
                    return _0x467f30 instanceof _0x303e14;
                },
                'uaGtq': function (_0x3a3799, _0x33cb67) {
                    return _0x3a3799(_0x33cb67);
                },
                'kXmlS': _0xb81108(0x20a),
                'GOswR': function (_0x409621, _0x4d2b5a) {
                    return _0x409621(_0x4d2b5a);
                },
                'wGJQl': function (_0x8d4e93, _0x397167) {
                    return _0x8d4e93(_0x397167);
                }
            };
        function _0x12153d(_0x39cf64) {
            const _0x2bc8c5 = _0xb81108;
            return _0x4fbe2d[_0x2bc8c5(0x210)](_0x39cf64, _0x461549) ? _0x39cf64 : new _0x461549(function (_0x28a185) {
                const _0x110b68 = _0x2bc8c5;
                _0x4fbe2d[_0x110b68(0x21b)](_0x28a185, _0x39cf64);
            });
        }
        return new (_0x461549 || (_0x461549 = Promise))(function (_0x18a4a8, _0x5d197c) {
            const _0xa48a38 = _0xb81108, _0x49fdf9 = {
                    'BDbLR': function (_0x37d77d, _0x24a7df) {
                        const _0x559789 = _0x1eee;
                        return _0x4fbe2d[_0x559789(0x238)](_0x37d77d, _0x24a7df);
                    }
                };
            function _0x433055(_0xd85339) {
                const _0x322cef = _0x1eee;
                try {
                    _0x49fdf9[_0x322cef(0x22a)](_0x1f436a, _0x285858[_0x322cef(0x226)](_0xd85339));
                } catch (_0x439356) {
                    _0x49fdf9[_0x322cef(0x22a)](_0x5d197c, _0x439356);
                }
            }
            function _0x1ef4e8(_0x54aabd) {
                const _0x435ab9 = _0x1eee;
                try {
                    _0x4fbe2d[_0x435ab9(0x237)](_0x1f436a, _0x285858[_0x4fbe2d[_0x435ab9(0x21a)]](_0x54aabd));
                } catch (_0x4eda09) {
                    _0x4fbe2d[_0x435ab9(0x21b)](_0x5d197c, _0x4eda09);
                }
            }
            function _0x1f436a(_0x48f198) {
                const _0x1e4be5 = _0x1eee;
                _0x48f198[_0x1e4be5(0x239)] ? _0x49fdf9[_0x1e4be5(0x22a)](_0x18a4a8, _0x48f198[_0x1e4be5(0x1d6)]) : _0x49fdf9[_0x1e4be5(0x22a)](_0x12153d, _0x48f198[_0x1e4be5(0x1d6)])[_0x1e4be5(0x202)](_0x433055, _0x1ef4e8);
            }
            _0x4fbe2d[_0xa48a38(0x1e7)](_0x1f436a, (_0x285858 = _0x285858[_0xa48a38(0x1cc)](_0x211b4d, _0x3e94ad || []))[_0xa48a38(0x226)]());
        });
    }, __importDefault = this && this[_0xd15c8e(0x1eb) + _0xd15c8e(0x20e)] || function (_0x4dc852) {
        const _0x83103a = _0xd15c8e;
        return _0x4dc852 && _0x4dc852[_0x83103a(0x1f5)] ? _0x4dc852 : { 'default': _0x4dc852 };
    };
const _0x375fc6 = {};
_0x375fc6[_0xd15c8e(0x1d6)] = !![], Object[_0xd15c8e(0x236) + _0xd15c8e(0x22c)](exports, _0xd15c8e(0x1f5), _0x375fc6);
function _0x297e() {
    const _0x572e03 = [
        'messages',
        'rs/AppErro',
        'CONNECTED',
        '38299qNARVd',
        'template\x20e',
        '../../help',
        'then',
        'aph.facebo',
        'bmToken',
        'idFront',
        's/logger',
        'en=',
        'ZcoOJ',
        'template',
        'throw',
        'Jbodn',
        'templates',
        'ack',
        'fault',
        '2434327SuDVSF',
        'hcJBS',
        '8wWIRUu',
        'teMessage',
        'kJlQf',
        'ers/socket',
        '6dPPiKe',
        'ate',
        '/messages?',
        'ok.com/v19',
        'tenantId',
        'kXmlS',
        'YmVts',
        '.0/',
        'LGDjt',
        'mediaType',
        'rror',
        '1374585UjrMJe',
        'chat:ack',
        'getTime',
        '3071457tBXBRG',
        'axios',
        'https://gr',
        'next',
        'Emit',
        'status',
        'now',
        'BDbLR',
        '1743zNvaFG',
        'erty',
        'ERR_WHATSA',
        '3828GDEFeU',
        'CFfJj',
        'name',
        '12419PIYPfI',
        'type',
        'update',
        'access_tok',
        'kQvfq',
        'defineProp',
        'uaGtq',
        'GOswR',
        'done',
        'WABA\x20send\x20',
        'bpAHE',
        '__awaiter',
        '../../util',
        'apply',
        'body',
        'whatsapp',
        'product',
        'payload',
        'ls/Message',
        'XPCDt',
        'contact',
        'jjBKs',
        'oqVsV',
        'value',
        '10sWyoNF',
        'QACKv',
        'TrwxT',
        'language',
        'POST',
        'Content-Ty',
        'data',
        'logger',
        'method',
        'messageId',
        'PP_OFFLINE',
        'uvgqS',
        'fromMe',
        'where',
        'messaging_',
        'edQDl',
        'wGJQl',
        '../../mode',
        'xGgia',
        'ticket:upd',
        '__importDe',
        'warn',
        'default',
        'applicatio',
        'AaSPm',
        'ls/Ticket',
        'n/json',
        'findOne',
        '../../erro',
        'sended',
        '__esModule',
        'sendTempla',
        'headers',
        'url',
        '76MtPdzV',
        '717350FkaomM',
        'code'
    ];
    _0x297e = function () {
        return _0x572e03;
    };
    return _0x297e();
}
const axios_1 = __importDefault(require(_0xd15c8e(0x224))), Ticket_1 = __importDefault(require(_0xd15c8e(0x1e8) + _0xd15c8e(0x1f0))), Message_1 = __importDefault(require(_0xd15c8e(0x1e8) + _0xd15c8e(0x1d1))), socketEmit_1 = __importDefault(require(_0xd15c8e(0x201) + _0xd15c8e(0x214) + _0xd15c8e(0x227))), AppError_1 = __importDefault(require(_0xd15c8e(0x1f3) + _0xd15c8e(0x1fd) + 'r')), logger_1 = require(_0xd15c8e(0x1cb) + _0xd15c8e(0x206));
class SendTemplateMessage {
    [_0xd15c8e(0x1f6) + _0xd15c8e(0x212)]({
        from: _0x752608,
        phone_number_id: _0x3bb908,
        message: _0x4a5563,
        ticket: _0x38463d,
        tenantId: _0x36a5f4,
        idFront: _0x56717b,
        whatsapp: _0x5d7130,
        language: _0x3fbbab,
        templateName: _0x57bed0
    }) {
        const _0x3c8e19 = _0xd15c8e, _0x4d1c5a = {
                'LGDjt': function (_0x14d5e2, _0x218fab) {
                    return _0x14d5e2 !== _0x218fab;
                },
                'ZcoOJ': _0x3c8e19(0x1fe),
                'kJlQf': _0x3c8e19(0x22d) + _0x3c8e19(0x1e1),
                'oqVsV': function (_0x48fcdf, _0x20bc4c) {
                    return _0x48fcdf === _0x20bc4c;
                },
                'edQDl': function (_0x4917bc, _0x10a2f2) {
                    return _0x4917bc === _0x10a2f2;
                },
                'kQvfq': _0x3c8e19(0x1db),
                'uvgqS': _0x3c8e19(0x1ce),
                'xGgia': _0x3c8e19(0x209),
                'CFfJj': _0x3c8e19(0x1ee) + _0x3c8e19(0x1f1),
                'XPCDt': function (_0x10460c, _0x39a20a) {
                    return _0x10460c || _0x39a20a;
                },
                'bpAHE': _0x3c8e19(0x20c),
                'TrwxT': _0x3c8e19(0x1f4),
                'AaSPm': _0x3c8e19(0x1ea) + _0x3c8e19(0x216),
                'QACKv': _0x3c8e19(0x221),
                'jjBKs': _0x3c8e19(0x23a) + _0x3c8e19(0x200) + _0x3c8e19(0x21f),
                'Jbodn': function (_0x189530, _0x4c271d, _0x2a7ca5, _0x11f2ed, _0x4a1398) {
                    return _0x189530(_0x4c271d, _0x2a7ca5, _0x11f2ed, _0x4a1398);
                }
            };
        return _0x4d1c5a[_0x3c8e19(0x20b)](__awaiter, this, void (0x103 * -0x15 + -0x1959 + -0xf88 * -0x3), void (0x1b3b * -0x1 + -0x1 * 0x1d4b + -0xa * -0x5a7), function* () {
            const _0x53fc26 = _0x3c8e19;
            if (_0x4d1c5a[_0x53fc26(0x21d)](_0x5d7130[_0x53fc26(0x228)], _0x4d1c5a[_0x53fc26(0x208)]))
                throw new AppError_1[(_0x53fc26(0x1ed))](_0x4d1c5a[_0x53fc26(0x213)], 0xe * 0x1e2 + -0x1e2e + 0x1 * 0x562);
            try {
                const _0x187e85 = _0x53fc26(0x225) + _0x53fc26(0x203) + _0x53fc26(0x218) + _0x53fc26(0x21c) + _0x3bb908 + (_0x53fc26(0x217) + _0x53fc26(0x234) + _0x53fc26(0x207)) + (_0x4d1c5a[_0x53fc26(0x1d5)](_0x5d7130, null) || _0x4d1c5a[_0x53fc26(0x1e6)](_0x5d7130, void (-0x1 * -0x6e7 + -0x3 * 0x221 + -0x84)) ? void (-0x14f6 * 0x1 + 0x1 * -0x5a1 + 0x8dd * 0x3) : _0x5d7130[_0x53fc26(0x204)]), _0x7d2e05 = {};
                _0x7d2e05[_0x53fc26(0x1fb)] = _0x3fbbab;
                const _0x2727cf = {};
                _0x2727cf[_0x53fc26(0x230)] = _0x57bed0, _0x2727cf[_0x53fc26(0x1da)] = _0x7d2e05;
                const _0x550bf9 = {};
                _0x550bf9[_0x53fc26(0x1df)] = _0x4d1c5a[_0x53fc26(0x235)], _0x550bf9[_0x53fc26(0x1f8)] = _0x187e85, _0x550bf9[_0x53fc26(0x1dd)] = {}, _0x550bf9[_0x53fc26(0x1f7)] = {}, _0x550bf9[_0x53fc26(0x1dd)][_0x53fc26(0x1e5) + _0x53fc26(0x1cf)] = _0x4d1c5a[_0x53fc26(0x1e2)], _0x550bf9[_0x53fc26(0x1dd)]['to'] = _0x752608, _0x550bf9[_0x53fc26(0x1dd)][_0x53fc26(0x232)] = _0x4d1c5a[_0x53fc26(0x1e9)], _0x550bf9[_0x53fc26(0x1dd)][_0x53fc26(0x209)] = _0x2727cf, _0x550bf9[_0x53fc26(0x1f7)][_0x53fc26(0x1dc) + 'pe'] = _0x4d1c5a[_0x53fc26(0x22f)];
                const _0x4a7c53 = yield (-0x8 * -0x1d3 + -0x12f1 * -0x2 + -0x1 * 0x347a, axios_1[_0x53fc26(0x1ed)])(_0x550bf9);
                let _0x5baa72 = Date[_0x53fc26(0x229)]();
                const _0x54777d = {
                        'messageId': _0x4a7c53[_0x53fc26(0x1dd)][_0x53fc26(0x1fc)][-0x966 + 0x1 * -0x1932 + 0x3 * 0xb88]['id'] || '',
                        'ticketId': _0x38463d['id'],
                        'contactId': _0x38463d[_0x53fc26(0x1d3)]['id'],
                        'body': _0x4d1c5a[_0x53fc26(0x1d2)](_0x4a5563, ''),
                        'fromMe': !![],
                        'mediaType': _0x4d1c5a[_0x53fc26(0x1c9)],
                        'read': !![],
                        'ack': 0x2,
                        'timestamp': _0x5baa72,
                        'status': _0x4d1c5a[_0x53fc26(0x1d9)]
                    }, _0x286224 = {};
                _0x286224['id'] = _0x38463d['id'];
                const _0x4d270c = {};
                _0x4d270c[_0x53fc26(0x1e4)] = _0x286224;
                const _0x1571c7 = yield Ticket_1[_0x53fc26(0x1ed)][_0x53fc26(0x1f2)](_0x4d270c);
                if (!_0x1571c7)
                    return;
                yield _0x1571c7[_0x53fc26(0x233)]({
                    'lastMessage': _0x54777d[_0x53fc26(0x1cd)],
                    'lastMessageAt': new Date()[_0x53fc26(0x222)](),
                    'answered': _0x4a7c53[_0x53fc26(0x1dd)][_0x53fc26(0x1e3)] || ![]
                });
                const _0x38a934 = {};
                _0x38a934[_0x53fc26(0x205)] = _0x56717b, _0x38a934[_0x53fc26(0x219)] = _0x36a5f4;
                const _0x4521b8 = {};
                _0x4521b8[_0x53fc26(0x1e4)] = _0x38a934;
                const _0x7691d1 = yield Message_1[_0x53fc26(0x1ed)][_0x53fc26(0x1f2)](_0x4521b8);
                if (!_0x7691d1)
                    return;
                const _0xf290d4 = {};
                _0xf290d4[_0x53fc26(0x1e0)] = _0x4a7c53[_0x53fc26(0x1dd)][_0x53fc26(0x1fc)][-0x1 * -0x3c1 + 0x1a3e + -0x1dff]['id'], _0xf290d4[_0x53fc26(0x21e)] = _0x4d1c5a[_0x53fc26(0x1c9)], _0xf290d4[_0x53fc26(0x20d)] = 0x2, _0xf290d4[_0x53fc26(0x228)] = _0x4d1c5a[_0x53fc26(0x1d9)], yield _0x7691d1[_0x53fc26(0x233)](_0xf290d4);
                const _0x400c61 = {};
                _0x400c61[_0x53fc26(0x219)] = _0x36a5f4, _0x400c61[_0x53fc26(0x232)] = _0x4d1c5a[_0x53fc26(0x1ef)], _0x400c61[_0x53fc26(0x1d0)] = _0x38463d, (0x1 * -0x20ff + -0x265 * -0x2 + -0x1d * -0xf9, socketEmit_1[_0x53fc26(0x1ed)])(_0x400c61);
                const _0xf1f90d = {};
                _0xf1f90d[_0x53fc26(0x1e0)] = _0x4a7c53[_0x53fc26(0x1dd)][_0x53fc26(0x1fc)][-0xc26 + 0x10b5 + -0x48f * 0x1]['id'], _0xf1f90d[_0x53fc26(0x219)] = _0x36a5f4;
                const _0x288e03 = {};
                _0x288e03[_0x53fc26(0x1e4)] = _0xf1f90d;
                const _0x1c9db7 = yield Message_1[_0x53fc26(0x1ed)][_0x53fc26(0x1f2)](_0x288e03);
                if (!_0x1c9db7)
                    return;
                const _0x204b44 = {};
                return _0x204b44[_0x53fc26(0x219)] = _0x36a5f4, _0x204b44[_0x53fc26(0x232)] = _0x4d1c5a[_0x53fc26(0x1d8)], _0x204b44[_0x53fc26(0x1d0)] = _0x1c9db7, (-0x14a + -0x3bc * -0x1 + 0x272 * -0x1, socketEmit_1[_0x53fc26(0x1ed)])(_0x204b44), _0x4a7c53[_0x53fc26(0x1dd)];
            } catch (_0x529274) {
                logger_1[_0x53fc26(0x1de)][_0x53fc26(0x1ec)](_0x4d1c5a[_0x53fc26(0x1d4)]);
                throw _0x529274;
            }
        });
    }
}
exports[_0xd15c8e(0x1ed)] = SendTemplateMessage;